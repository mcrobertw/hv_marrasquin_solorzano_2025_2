{% extends "base.html" %}

{% block title %}Inicio{% endblock %}


{% block content %}

<div class="home-shell home-shell--grid">


  {% if perfil %}

    <!-- ===== Columna izquierda ===== -->

    <div class="home-left">


      <section class="home-profile">

        <div class="hp-left">

          {% if perfil.foto_perfil %}

            <img class="hp-avatar" src="{{ perfil.foto_perfil.url }}" alt="Foto">

          {% endif %}

        </div>


        <div class="hp-right">

          <h1 class="hp-name">{{ perfil.nombres }} {{ perfil.apellidos }}</h1>


          {% if perfil.descripcionperfil %}

            <p class="hp-desc">{{ perfil.descripcionperfil }}</p>

          {% endif %}


          <div class="hp-grid">

            {% if perfil.nacionalidad %}<div><b>Nacionalidad:</b> {{ perfil.nacionalidad }}</div>{% endif %}

            {% if perfil.lugarnacimiento %}<div><b>Lugar:</b> {{ perfil.lugarnacimiento }}</div>{% endif %}

            {% if perfil.fechanacimiento %}<div><b>Nacimiento:</b> {{ perfil.fechanacimiento }}</div>{% endif %}

            {% if perfil.numerocedula %}<div><b>C√©dula:</b> {{ perfil.numerocedula }}</div>{% endif %}

            {% if perfil.sexo %}<div><b>Sexo:</b> {{ perfil.sexo }}</div>{% endif %}


            {% if perfil.sitioweb %}

              <div>

                <b>Web:</b>

                <a class="btn-outline" href="{{ perfil.sitioweb }}" target="_blank" rel="noopener">

                  Abrir enlace

                </a>

              </div>

            {% endif %}

          </div>


          {# BOT√ìN IZQUIERDO ELIMINADO (dejar solo el de la derecha) #}

        </div>

      </section>


      <section class="home-sections">

        <h2 class="hs-title">Secciones</h2>

        <div class="hs-grid">

          <a class="hs-card" href="{% url 'datos_personales' %}">üßç Datos personales</a>

          <a class="hs-card" href="{% url 'cursos' %}">üéì Cursos realizados</a>

          <a class="hs-card" href="{% url 'experiencia' %}">üõ†Ô∏è Experiencia laboral</a>

          <a class="hs-card" href="{% url 'productos_academicos' %}">üìò Productos acad√©micos</a>

          <a class="hs-card" href="{% url 'productos_laborales' %}">üíº Productos laborales</a>

          <a class="hs-card" href="{% url 'reconocimientos' %}">üèÖ Reconocimientos</a>

          <a class="hs-card" href="{% url 'venta_garage' %}">üè∑Ô∏è Venta garage</a>

        </div>

      </section>


    </div>


    <!-- ===== Columna derecha (inventado) ===== -->

    <aside class="home-right">

      <div class="side-card">

        <div class="side-head">

          <div class="side-title">Resumen r√°pido</div>

          <div class="side-chip">CV</div>

        </div>


        <div class="side-metrics">

          <div class="metric">

            <div class="m-num">{{ counts.cursos }}</div>

            <div class="m-lbl">Cursos</div>

          </div>

          <div class="metric">

            <div class="m-num">{{ counts.experiencias }}</div>

            <div class="m-lbl">Experiencias</div>

          </div>

          <div class="metric">

            <div class="m-num">{{ counts.reconoc }}</div>

            <div class="m-lbl">Reconoc.</div>

          </div>

          <div class="metric">

            <div class="m-num">{{ counts.prod_acad }}</div>

            <div class="m-lbl">Prod. Acad.</div>

          </div>

          <div class="metric">

            <div class="m-num">{{ counts.prod_lab }}</div>

            <div class="m-lbl">Prod. Lab.</div>

          </div>

          <div class="metric">

            <div class="m-num">{{ counts.venta }}</div>

            <div class="m-lbl">Venta</div>

          </div>

        </div>


        <div class="side-sep"></div>


        <div class="side-status">

          <div class="st-row">

            <span class="st-k">Impresi√≥n</span>

            {% if permitir_impresion %}

              <span class="st-ok">Habilitada</span>

            {% else %}

              <span class="st-bad">Bloqueada</span>

            {% endif %}

          </div>

          <div class="st-row">

            <span class="st-k">Perfil activo</span>

            {% if perfil.perfilactivo %}

              <span class="st-ok">S√≠</span>

            {% else %}

              <span class="st-bad">No</span>

            {% endif %}

          </div>

        </div>


        {% if permitir_impresion %}

          <!-- Antes era un <a>. Ahora abrimos modal -->

          <button type="button" class="side-btn" onclick="abrirModalPDF()">

            Generar PDF ‚Üí

          </button>

        {% endif %}

      </div>


      <div class="side-card side-card--hint">

        <div class="side-title">Tip</div>

        <p class="side-text">

          Para que una secci√≥n no aparezca en el PDF, solo deja esa secci√≥n sin registros.

          Los certificados (im√°genes) se imprimen en hoja completa autom√°ticamente.

        </p>

      </div>

    </aside>


    {% if permitir_impresion %}

      <!-- ========= MODAL PDF ========= -->

      <div id="modalPDF" class="pdf-modal" aria-hidden="true">

        <div class="pdf-card" role="dialog" aria-modal="true" aria-labelledby="pdfTitle">

          <div id="pdfTitle" class="pdf-title">Seleccionar Secciones para PDF</div>


          <form method="GET" action="{% url 'imprimir_hoja_vida' %}" target="_blank" rel="noopener" onsubmit="return validarPDF()">


            <label class="pdf-opt">

              <input type="checkbox" name="exp" checked>

              <span>Incluir Experiencia</span>

            </label>


            <label class="pdf-opt">

              <input type="checkbox" name="cursos" checked>

              <span>Incluir Cursos/T√≠tulos</span>

            </label>


            <label class="pdf-opt">

              <input type="checkbox" name="recon" checked>

              <span>Incluir Logros</span>

            </label>


            <label class="pdf-opt">

              <input type="checkbox" name="pa" checked>

              <span>Incluir Prod. Acad√©micos</span>

            </label>


            <label class="pdf-opt">

              <input type="checkbox" name="pl" checked>

              <span>Incluir Proyectos</span>

            </label>


            <label class="pdf-opt">

              <input type="checkbox" name="vg">

              <span>Incluir Venta Garage</span>

            </label>


            <div id="pdfError" class="pdf-error" style="display:none;">

              Selecciona al menos una secci√≥n.

            </div>


            <div class="pdf-actions">

              <button type="button" class="pdf-btn pdf-btn--cancel" onclick="cerrarModalPDF()">Cancelar</button>

              <button type="submit" class="pdf-btn pdf-btn--ok">Generar PDF</button>

            </div>

          </form>

        </div>

      </div>


      <script>

        function abrirModalPDF(){

          const m = document.getElementById("modalPDF");

          m.style.display = "flex";

          m.setAttribute("aria-hidden", "false");

          document.getElementById("pdfError").style.display = "none";

        }


        function cerrarModalPDF(){

          const m = document.getElementById("modalPDF");

          m.style.display = "none";

          m.setAttribute("aria-hidden", "true");

        }


        // cerrar al hacer click fuera del cuadro

        document.addEventListener("click", function(e){

          const m = document.getElementById("modalPDF");

          if (!m) return;

          if (m.style.display === "flex" && e.target === m) cerrarModalPDF();

        });


        // ESC para cerrar

        document.addEventListener("keydown", function(e){

          if (e.key === "Escape") cerrarModalPDF();

        });


        function validarPDF(){

          const form = document.querySelector('#modalPDF form');

          const checks = form.querySelectorAll('input[type="checkbox"]');

          const ok = Array.from(checks).some(c => c.checked);

          const err = document.getElementById("pdfError");

          if(!ok){

            err.style.display = "block";

            return false;

          }

          err.style.display = "none";

          cerrarModalPDF();

          return true;

        }

      </script>

    {% endif %}


  {% else %}

    <p>No hay perfil activo. Act√≠valo en el Admin.</p>

  {% endif %}


</div>

{% endblock %}